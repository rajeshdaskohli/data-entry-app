<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Expense Dashboard</title>
  <style>
    :root { --bg: #f4f6f9; --dark: #1e1e2d; --green: #2ecc71; --red: #e74c3c; }
    body { margin: 0; background: var(--bg); font-family: sans-serif; padding-bottom: 30px; }
    .container { max-width: 480px; margin: 0 auto; padding: 15px; }

    /* Top Cards */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    .card { background: #fff; padding: 15px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.04); border-left: 5px solid var(--dark); }
    .card h4 { margin: 0 0 5px; font-size: 11px; color: #888; text-transform: uppercase; }
    .card p { margin: 0; font-size: 22px; font-weight: 800; color: #2d3436; }

    /* Category Section - FIXED CARDS */
    .sec-title { font-weight: 800; margin: 25px 0 10px; font-size: 15px; color: #444; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .cat-box { 
      background: #fff; padding: 12px 5px; border-radius: 12px; text-align: center; 
      border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }
    .cat-box h5 { margin: 0; font-size: 10px; color: #aaa; text-transform: uppercase; }
    .cat-box p { margin: 4px 0 0; font-size: 14px; font-weight: 700; color: #333; }

    /* Lists */
    .list-box { background: #fff; border-radius: 18px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 15px; }
    .row { display: flex; justify-content: space-between; padding: 14px 15px; border-bottom: 1px solid #f5f5f5; font-size: 14px; font-weight: 600; }
    .row:last-child { border-bottom: none; }
    .pos { color: var(--green); }
    .neg { color: var(--red); }
  </style>
</head>
<body>

<div class="container">
  
  <div class="grid-2">
    <div class="card" style="border-color:#f1c40f"><h4>Today</h4><p id="topToday">‚Çπ0</p></div>
    <div class="card" style="border-color:#e91e63"><h4>Month</h4><p id="topMonth">‚Çπ0</p></div>
    <div class="card" style="border-color:#2ecc71"><h4>Funds</h4><p id="topFund">‚Çπ0</p></div>
    <div class="card" style="border-color:#3498db" onclick="fetchData()"><h4>Status</h4><p id="status" style="font-size:14px">Refresh üîÑ</p></div>
  </div>

  <div class="sec-title">üè∑Ô∏è Category Summary</div>
  <div class="grid-3">
    <div class="cat-box"><h5>Manjeet</h5><p id="val-manjeet">‚Çπ0</p></div>
    <div class="cat-box"><h5>Food</h5><p id="val-food">‚Çπ0</p></div>
    <div class="cat-box"><h5>Other</h5><p id="val-other">‚Çπ0</p></div>
    <div class="cat-box"><h5>Health</h5><p id="val-health">‚Çπ0</p></div>
    <div class="cat-box"><h5>Travel</h5><p id="val-travel">‚Çπ0</p></div>
    <div class="cat-box"><h5>Shopping</h5><p id="val-shopping">‚Çπ0</p></div>
  </div>

  <div style="display:flex; justify-content:space-between; margin:20px 0 10px; font-weight:800;">
    <span>üè¶ Bank Accounts</span><span id="bankTotal" class="pos">‚Çπ0</span>
  </div>
  <div class="list-box" id="bankList"></div>

  <div style="display:flex; justify-content:space-between; margin:20px 0 10px; font-weight:800;">
    <span>üí≥ Credit Cards</span><span id="cardTotal" class="neg">‚Çπ0</span>
  </div>
  <div class="list-box" id="cardList"></div>

</div>

<script>
  // ********** ‡§Ö‡§™‡§®‡§æ ‡§®‡§Ø‡§æ DEPLOYMENT URL ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç **********
  const API_URL = "https://script.google.com/macros/s/AKfycbwXkJo6belMLPwHAEQLoA9VD1MNCArzuddtcqYRQSFsvTeuo0tjP8Ilut5ZU0Yf4HtA/exec"; 

  function fetchData() {
    document.getElementById("status").innerText = "Loading...";
    
    fetch(API_URL, { method: "POST", body: JSON.stringify({action: "getDashboard"}) })
      .then(r => r.json())
      .then(res => {
        if(res.ok) {
          updateUI(res);
          document.getElementById("status").innerText = "Active ‚úÖ";
        } else {
          document.getElementById("status").innerText = "Error ‚ùå";
        }
      })
      .catch(e => {
        document.getElementById("status").innerText = "Fail ‚ö†Ô∏è";
        console.log(e);
      });
  }

  function updateUI(db) {
    // 1. Top Cards
    document.getElementById("topToday").innerText = "‚Çπ" + Math.round(db.summary.today);
    document.getElementById("topMonth").innerText = "‚Çπ" + Math.round(db.summary.month);
    document.getElementById("topFund").innerText = "‚Çπ" + Math.round(db.summary.funds);

    // 2. Categories (Update by ID)
    // ‡§Ø‡§π ‡§ï‡•ã‡§° ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§®‡§Ç‡§¨‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§ó‡§æ, ‡§ï‡§æ‡§∞‡•ç‡§°‡•ç‡§∏ ‡§ï‡•ã ‡§õ‡•á‡§°‡§º‡•á‡§ó‡§æ ‡§®‡§π‡•Ä‡§Ç
    const cats = db.summary.catTotals;
    if(cats) {
      updateCat("val-manjeet", cats.manjeet);
      updateCat("val-food", cats.food);
      updateCat("val-other", cats.other);
      updateCat("val-health", cats.health);
      updateCat("val-travel", cats.travel);
      updateCat("val-shopping", cats.shopping);
    }

    // 3. Banks (Math Fix included)
    let bTot = 0;
    document.getElementById("bankList").innerHTML = db.banks.map(b => {
      let v = Number(b.val);
      bTot += v;
      return `<div class="row"><span>${b.name}</span><span class="pos">‚Çπ${v.toFixed(2)}</span></div>`;
    }).join("");
    document.getElementById("bankTotal").innerText = "‚Çπ" + bTot.toFixed(2);

    // 4. Cards
    let cTot = 0;
    document.getElementById("cardList").innerHTML = db.cards.map(c => {
      let v = Number(c.val);
      cTot += v;
      return `<div class="row"><span>${c.name}</span><span class="neg">‚Çπ${v.toFixed(2)}</span></div>`;
    }).join("");
    document.getElementById("cardTotal").innerText = "‚Çπ" + cTot.toFixed(2);
  }

  function updateCat(id, val) {
    const el = document.getElementById(id);
    if(el) el.innerText = "‚Çπ" + Math.round(Number(val || 0));
  }

  window.onload = fetchData;
</script>

</body>
</html>
